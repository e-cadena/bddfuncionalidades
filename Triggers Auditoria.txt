CREATE TABLE auditoria
(
codigo integer,
nombre character varying
);

SELECT * FROM auditoria

CREATE TABLE PERSONAS 
(
	ID_PERSONA VARCHAR(1000) NOT NULL DEFAULT NEXTVAL('PERSONAS'::REGCLASS), 
	CEDULA_O_RUC VARCHAR (12) NOT NULL,
	NOMBRE VARCHAR(30) NOT NULL,
	APELLIDO VARCHAR(30) NOT NULL,
	TELEFONO TEXT NOT NULL,
	CONSTRAINT PERSONA_PKEY PRIMARY KEY (ID_PERSONA)
);

INSERT INTO personas (ID_PERSONA,CEDULA_O_RUC ,NOMBRE,APELLIDO,TELEFONO)
VALUES(1,'1719938340','Esteban','Cadena',0993950606),
(2,'1702592757','Rodrigo','Valverde',0999434775),
(3,'1713258644','Gabriela','Valverde',098679908);

SELECT * FROM personas

CREATE TABLE EMPRESAS
(
ID_EMPRESA VARCHAR(1000) NOT NULL DEFAULT NEXTVAL('PERSONAS'::REGCLASS), 
	
NOMBRE_EMPRESA VARCHAR(30) NOT NULL,

TELEFONO TEXT NOT NULL,
CONSTRAINT EMPRESA_PKEY PRIMARY KEY (ID_EMPRESA)
);

INSERT INTO empresas(ID_EMPRESA,NOMBRE_EMPRESA,TELEFONO)
VALUES(1,'Handytec',098742518),
(2,'Biometrika',0985627458),
(3,'Saviasoft',09272555154);

SELECT * FROM empresas

CREATE TABLE CLIENTES
(
	ID_CLIENTE VARCHAR(1000) NOT NULL DEFAULT NEXTVAL('CLIENTES'::REGCLASS), 
	ID_PERSONA VARCHAR (1000) NOT NULL,
	CORREO VARCHAR (100) NOT NULL,
	CONSTRAINT CLIENTE_PKEY PRIMARY KEY (ID_CLIENTE)
);
CREATE TABLE clientes
(
	ID_VENTA VARCHAR(1000) NOT NULL DEFAULT NEXTVAL('VENTAS'::REGCLASS), 

	NUMERO_FACTURA VARCHAR (50) NOT NULL,
	ID_EMPRESA VARCHAR (1000) NOT NULL,
	ID_CLIENTE VARCHAR (1000) NOT NULL,
	PRECIO DECIMAL NOT NULL,
 	CONSTRAINT VENTA_PKEY PRIMARY KEY (ID_VENTA)
	);



SELECT * FROM VENTAS 

ALTER TABLE CLIENTES ADD CONSTRAINT FK_ID_PERSONA FOREIGN KEY (ID_PERSONA) REFERENCES PERSONAS(ID_PERSONA)
	ON DELETE CASCADE;
ALTER TABLE VENTAS ADD CONSTRAINT FK_ID_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES(ID_CLIENTE)
ON DELETE CASCADE;
ALTER TABLE VENTAS ADD CONSTRAINT FK_ID_EMPRESA FOREIGN KEY (ID_EMPRESA) REFERENCES EMPRESAS(ID_EMPRESA)
ON DELETE CASCADE;

//crear funcion q retona triger
 
CREATE OR REPLACE FUNCTION insertar_trigger() RETURNS TRIGGER AS $insertar$ 
DECLARE BEGIN
	INSERT INTO auditoria VALUES(OLD.codigo,OLD.nombre);
	RETURN NULL;
END;
$insertar$ LANGUAGE plpgsql;

CREATE TRIGGER insert_auditoria AFTER DELETE
ON personas FOR EACH ROW 

CREATE TRIGGER insert_auditoria AFTER DELETE
ON personas FOR EACH ROW 
EXECUTE PROCEDURE insertar_trigger();

delete from personas where ID_PERSONA=2